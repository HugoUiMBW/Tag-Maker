<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Tag Generator - Mobile</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link id="google-fonts-link" href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@800;900&family=Inter:wght@400&family=Libre+Barcode+EAN13+Text&display=swap" rel="stylesheet">

    <style>
        /* CSS styles are omitted for brevity but should be included from the original file */
        @import url('https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@800;900&family=Inter:wght@400&family=Libre+Barcode+EAN13+Text&display=swap');
        .barcode-font { font-family: 'Libre Barcode EAN13 Text', cursive; }
        .price-tag-container { font-family: 'Inter', sans-serif; width: 3in; height: 1.25in; background: #FFFFFF; position: relative; overflow: hidden; color: #000000; box-sizing: border-box; flex-shrink: 0; }
        .price-tag-left { position: absolute; left: 0px; top: 0px; width: 60%; padding: 10px; display: flex; flex-direction: column; gap: 5px; align-items: flex-start; }
        .brand-box { box-sizing: border-box; border: 1px solid #000000; padding: 5px; display: inline-block; min-width: 20px; max-width: 100%; height: auto; min-height: 24px; font-size: 14px; line-height: 16px; font-weight: 400; word-break: break-word; white-space: pre-line; overflow-wrap: break-word; }
        .product-box { font-size: 14px; line-height: 16px; font-weight: 400; max-width: 100%; word-break: break-word; min-height: 16px; }
        .price-tag-right { position: absolute; left: 60%; top: 0px; width: 40%; height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: flex-end; padding: 10px 12px 6px 0px; box-sizing: border-box; }
        .price-main-box { display: inline-flex; flex-direction: row; justify-content: flex-end; align-items: center; background: #8EBC77; height: 72px; }
        .price-dollars-box { display: flex; justify-content: flex-end; align-items: center; padding: 2px 4px 5px 6px; background: #8EBC77; font-family: 'Barlow Condensed', sans-serif; font-weight: 800; font-size: 58px; text-align: right; line-height: 1; }
        .price-cents-section { display: flex; flex-direction: column; justify-content: center; align-items: flex-start; gap: 3px; width: 40px; }
        .price-cents-box { display: flex; align-items: center; padding: 0px 6px 0px 0px; background: #8EBC77; font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 29px; line-height: 26px; text-align: right; width: 40px; height: 26px; }
        .price-sale-box { display: flex; align-items: center; padding: 0px 6px 3px 0px; background: #8EBC77; font-family: 'Barlow Condensed', sans-serif; font-weight: 900; font-size: 21px; line-height: 16px; text-align: right; width: 30px; height: 19px; }
        .barcode-clipper { position: absolute; height: 28px; left: 60%; right: 12px; top: 80px; overflow: hidden; }
        .barcode-text-content { position: relative; top: -40px; font-size: 72px; line-height: 68px; text-align: right; color: #000000; }
        [contenteditable]:empty:before { content: attr(data-placeholder); color: #9ca3af; font-style: italic; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        </div>

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900">Price Tag Generator</h1>
        </header>

        <div id="live-preview-container" class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4 flex-wrap">
                <h2 class="text-2xl font-semibold">Preview</h2>
                <div class="flex items-center gap-2 flex-wrap justify-center">
                    <button id="print-letter-iphone" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-md transition-colors">Generate iPhone PDF</button>
                </div>
            </div>
            <div id="live-preview-area" class="flex flex-wrap justify-center gap-4 p-4 bg-gray-50 rounded-md min-h-[420px] items-start">
            </div>
        </div>
    </div>

    <script>
        let tagsData = [];

        function loadTagsFromUrl() {
            // **This part might need changing.** The current script reads from `window.location.search`.
            // When hosted, the data might be in the hash (`window.location.hash`) to avoid URL encoding issues.
            const params = new URLSearchParams(window.location.search);
            let dataParam = params.get('data');

            // Fallback to reading from hash
            if (!dataParam && window.location.hash) {
                try {
                    dataParam = window.location.hash.substring(1); // Remove the '#'
                } catch (e) { /* ignore */ }
            }

            if (dataParam) {
                try {
                    const decodedJson = atob(dataParam);
                    const parsedData = JSON.parse(decodedJson);
                    if (Array.isArray(parsedData)) {
                        tagsData = parsedData.map(tag => ({ ...tag, id: Date.now() + Math.random() }));
                    }
                } catch (error) {
                    console.error("Failed to parse data from URL:", error);
                    document.getElementById('live-preview-area').innerHTML = `<p class="text-red-500">Error: Could not load item data. The data format was invalid.</p>`;
                }
            }
        }
        
        function createPriceTagElement(tag) {
            const tagEl = document.createElement('div');
            tagEl.className = 'price-tag-container';
            tagEl.dataset.id = tag.id;
            tagEl.innerHTML = `
                <div class="price-tag-left">
                    <div class="brand-box">${tag.brand || ''}</div>
                    <div class="product-box">${tag.product || ''}</div>
                </div>
                <div class="price-tag-right">
                    <div class="price-main-box">
                        <div class="price-dollars-box"><span>${tag.dollars || ''}</span></div>
                        <div class="price-cents-section">
                            <div class="price-cents-box"><span>${tag.cents || ''}</span></div>
                            <div class="price-sale-box"><span>${tag.sale || ''}</span></div>
                        </div>
                    </div>
                </div>
                <div class="barcode-clipper">
                    <div class="barcode-text-content barcode-font">${(tag.barcode || '').slice(0, 13)}</div>
                </div>`;
            return tagEl;
        }

        function renderPreview() {
            const livePreviewArea = document.getElementById('live-preview-area');
            livePreviewArea.innerHTML = '';
            if (tagsData.length === 0) {
                livePreviewArea.innerHTML = `<p class="text-gray-500">No tags to display. Use the 'Tag Maker' shortcut to scan items.</p>`;
            } else {
                tagsData.forEach(tag => livePreviewArea.appendChild(createPriceTagElement(tag)));
            }
        }
        
        // PDF generation functions (omitted for brevity) are also in the script.

        document.addEventListener('DOMContentLoaded', () => {
            loadTagsFromUrl();
            renderPreview();
        });
    </script>
</body>
</html>
